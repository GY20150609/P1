# 概率问题求解

>示例1：n个样本中随机抽m个样本，保证每个样本被选取的概率相等

## 1.抽样法（已知总体n）
```aidl
设定每次选中的概率,该概率取决于当前待选取样本和之前已经选取的样本数
p = (m - k) / (n - i + 1)

eg:第一次选取，选中概率 
p1 = m / n
eg:第二次选取，有两种情况，前面没有选中，当前选中；前面第一次选中，当前选中；
p2 = (1 - (m / n)) * (m / (n-1)) + (m / n) * ((m-1)/(n-1)) 
```

## 2.蓄水池抽样法 （未知总体n）
```aidl
已知样本数大于m,选取样本数不超过m时，直接选取当前元素；

选取样本数超过m时，按一定概率将当前元素和前面的元素交换
    for i = m+1 to n
        r = Random(1,i)
        if r <= m 
            swap i and r
```
>示例2：给定一个等概率生成0和1的生成器，设计一个能等概率生成0，1，2，3的生成器 <br/>
>示例3：给定一个以概率p生成0，以1-p概率生成1的生成器，设计一个能等概率生成0和1的生成器 <br/>
>示例4：如何用等概率rand7（随机生成1-7）构建等概率rand9（随机生成1-9）

## 3.级联法 （已知某个事件的概率）
```aidl
一般思路：多次调用基础生成器,利用组合情况,完成概率的调整
示例2：调用两次会有四种情况,(0,0),(0,1),(1,0),(1,1)概率相等,分别对应0,1,2,3即可；
示例3：同样调用两次，其中(0,1)与(1,0)概率相等，分别对应0与1，其他情况不返回；
示例4：调用rand7两次，会有49种组合情况，舍弃掉最后4种情况不作返回，其他45种均匀归到9类里面；
```

## 4.方程法
>示例5：A,B,C三⼈轮流扔硬币，第⼀个扔到正⾯的⼈算赢，问三个⼈赢的概率分别为多⼤ <br/>
```aidl
思路：化大为小，递推法
第一轮：
A赢 ： 0.5
B赢 ： 0.5^2
C赢 ： 0.5^3 

第二轮：前提是第一轮没人赢
A赢 ： 0.5^3 * 0.5
B赢 ： 0.5^3 * 0.5^2
C赢 ： 0.5^3 * 0.5^3

...
A赢 ： p(A) = 0.5 + 0.5^3 * 0.5 + 0.5^6 * 0.5 + ... + 0.5^(i*3) * 0.5
B赢 ： p(B) = 0.5 * p(A)
C赢 ： p(C) = 0.5^2 * p(A)

等比数列求和公式：
p(A) = a1 * (1 - q^n) / (1- q) = 4 / 7 
p(B) = 2 / 7
p(C) = 1 / 7
```
>示例6：A有n个硬币,B有n+1个硬币,谁丢的正⾯多谁赢,问A不输的概率
```aidl
思路：化大为小，方程法
P(A>B)表示A赢的概率
p(A<B)表示B赢的概率
p(A=B)表示相等的概率
Step1：考虑A,B均扔n个硬币的情况，两边事件独立，且状态相同
则p(A>B) + p(A<B) + p(A=B) = 1 且 p(A>B) = p(A<B)
Step2：由于B还有一枚硬币，此时对前面n个硬币分情况讨论
1. A < B,此时B无论投出啥,A都输
2. A = B,此时B投出正面，A会输
3. A > B,此时B无论投出啥，A肯定不输
此时A输的概率为： p = p(A<B) + p(A=B)*0.5 = 0.5 * (2*p(A<B) + p(A=B)) = 0.5
则A不输的概率为： q = 1 - p = 0.5
```

## 没有办法
>示例7：⼀个机器人在原点，右边有⼀个距离为k的点，机器⼈以p的概率右移一步，1-p概率左移
     ⼀步，问经过M步机器⼈人出于k点的概率 <br/>
```aidl
思路：就是干
机器人最终肯定是右移k步，剩下的M-k步中，一半右移一半左移
隐形约束：（M-k）% 2 = 0 且 M >> k
最终其实就是从M步操作中随机选取 k + (M-k)/2步作为右移
p = C(k+(M-k)/2,M) 
```

## 归纳法
>示例8：扔硬币直到连续两次出现正⾯，求扔的期望次数
```aidl
思路：某类事件的期望次数，肯定是各子事件期望次数之和，分情况来看
1.第一次就扔了反面，那就代表必须重新开始才能达成两次连续正面，那么除本此外还需要E次
期望次数 E1 = 0.5 * （1 + E）
2.第一次扔了正面，第二次就扔了反面，一夜回到解放前，wtf!
期望次数 E2 = 0.5 * 0.5 * (2 + E)
3.草鸡幸运，两次都是正面
期望次数 E3 = 0.5*0.5*2 
E = E1 + E2 + E3
最终 E = 6
```


